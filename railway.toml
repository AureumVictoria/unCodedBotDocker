# UnCoded Trading Bot - Railway Configuration
# Dieses File deployt alle Services automatisch

[build]
  builder = "nixpacks"

# PostgreSQL Database
[[services]]
name  = "postgres"
image = "postgres:16-alpine"

  [services.postgres.variables]
  POSTGRES_DB       = "tradingbot"
  POSTGRES_USER     = "postgres"
  POSTGRES_PASSWORD = "${RAILWAY_PASSWORD}"

  [[services.postgres.volumes]]
  mount = "/var/lib/postgresql/data"
  name  = "postgres-data"

# Trading Bot Service
[[services]]
name  = "trading-bot"
image = "aureumvictoria/unCodedBotDocker:latest"

  [services.trading-bot.variables]
  # Nutze den DOCKER_ENV-Branch für individuelle PG-Variablen
  DOCKER_ENV        = "true"
  # Korrekte Railway-Interpolation für deine Postgres-Instanz
  POSTGRES_HOST     = "${{trading-postgres.RAILWAY_PRIVATE_DOMAIN}}"
  POSTGRES_PORT     = "${{trading-postgres.RAILWAY_PORT}}"
  POSTGRES_DB       = "${{trading-postgres.RAILWAY_DATABASE}}"
  POSTGRES_USER     = "${{trading-postgres.RAILWAY_USER}}"
  POSTGRES_PASSWORD = "${{trading-postgres.RAILWAY_PASSWORD}}"
  # Fall­back für Libraries, die einen Connection String erwarten
  DATABASE_URL      = "${{trading-postgres.RAILWAY_URL}}"
  # Binance API placeholders
  API_KEY           = ""
  API_SECRET        = ""

  [services.trading-bot.deploy]
  restartPolicyType      = "ON_FAILURE"
  restartPolicyMaxRetries = 10

# Telegram Bot Service
[[services]]
name  = "telegram-bot"
image = "aureumvictoria/unCodedBotDocker:latest"

  [services.telegram-bot.variables]
  # Nutzt nur DATABASE_URL für Verbindung
  DATABASE_URL      = "${postgres.RAILWAY_URL}"
  TELEGRAM_BOT_TOKEN = ""
  TELEGRAM_GROUP_ID  = ""
  TELEGRAM_OWNER_ID  = ""

  [services.telegram-bot.deploy]
  restartPolicyType      = "ON_FAILURE"
  restartPolicyMaxRetries = 5
