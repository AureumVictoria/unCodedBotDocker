# railway.toml
# Finale, robusteste Konfiguration für den automatisierten Deploy von GitHub.
# Diese Version enthält nun auch die Definition der Umgebungsvariablen.

# Globale Build-Einstellungen
[build]
# Wir weisen Railway an, die Dockerfiles in den jeweiligen Ordnern zu verwenden.
builder = "DOCKER"

# Globale Deployment-Einstellungen
[deploy]
# Startet Dienste bei einem Fehler automatisch neu.
restartPolicy = "ON_FAILURE"
# Versucht den Neustart bis zu 10 Mal.
restartPolicyMaxRetries = 10

# --- Definition des Trading-Bot-Dienstes ---
[[services]]
name = "trading-bot"
dockerfilePath = "./trading-bot/Dockerfile"

  # Umgebungsvariablen für den Trading-Bot
  [services.variables]
  # Diese Variablen verbinden den Bot mit dem PostgreSQL-Dienst.
  # Der Name 'PostgreSQL' muss exakt dem Namen des Datenbank-Dienstes in Railway entsprechen.
  POSTGRES_HOST = "${{PostgreSQL.PGHOST}}"
  POSTGRES_USER = "${{PostgreSQL.PGUSER}}"
  POSTGRES_PASSWORD = "${{PostgreSQL.PGPASSWORD}}"
  POSTGRES_DB = "${{PostgreSQL.PGDATABASE}}"
  POSTGRES_PORT = "${{PostgreSQL.PGPORT}}"
  DOCKER_ENV = "true"

  # WICHTIG: Fügen Sie Ihre echten API-Keys NICHT hier ein.
  # Setzen Sie diese in der Railway-Weboberfläche.
  API_KEY = ""
  API_SECRET = ""

# --- Definition des Telegram-Bot-Dienstes ---
[[services]]
name = "telegram-bot"
dockerfilePath = "./telegram-bot/Dockerfile"

  # Umgebungsvariablen für den Telegram-Bot
  [services.variables]
  # Verbindung zur selben PostgreSQL-Datenbank
  POSTGRES_HOST = "${{PostgreSQL.PGHOST}}"
  POSTGRES_USER = "${{PostgreSQL.PGUSER}}"
  POSTGRES_PASSWORD = "${{PostgreSQL.PGPASSWORD}}"
  POSTGRES_DB = "${{PostgreSQL.PGDATABASE}}"
  POSTGRES_PORT = "${{PostgreSQL.PGPORT}}"

  # WICHTIG: Fügen Sie Ihre echten Telegram-Secrets NICHT hier ein.
  # Setzen Sie diese in der Railway-Weboberfläche.
  TELEGRAM_BOT_TOKEN = ""
  TELEGRAM_GROUP_ID = ""
  TELEGRAM_OWNER_ID = ""

# --- Definition des Datenbank-Dienstes ---
# Dies ist die offizielle Standard-Syntax. Sie erstellt einen von Railway
# verwalteten PostgreSQL-Dienst. In der Railway-Oberfläche wird dieser
# Dienst standardmäßig "PostgreSQL" heißen.
[plugins.postgres]
